<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ë‚˜ì˜ ëŒ€ì‹œë³´ë“œ (ë£¨í‹´ Â· ë·°í‹°)</title>

<style>
:root{
  --bg:#0b1020; --card:#121a33; --text:#e9eeff; --muted:#8ea0c9;
  --line:rgba(255,255,255,.10); --accent:#7c5cff; --ok:#3ddc97; --danger:#ff6b6b;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,-apple-system,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;
  background:linear-gradient(180deg,#0b1020,#0e1430);color:var(--text)
}

/* ===== ìƒë‹¨ íƒ­ ===== */
.top{
  display:flex;gap:10px;padding:14px;
  border-bottom:1px solid rgba(255,255,255,.10);
  background:#0e1430; position:sticky; top:0; z-index:50;
}
.top .tabbtn{
  padding:10px 14px;border-radius:12px;
  border:1px solid rgba(255,255,255,.15);
  background:rgba(255,255,255,.05);
  color:#fff;cursor:pointer
}
.top .tabbtn.active{border-color:var(--accent);background:rgba(124,92,255,.25)}
.page{display:none}
.page.active{display:block}

/* ===== ê³µí†µ UI ===== */
.wrap{max-width:920px;margin:0 auto;padding:18px}
h1{margin:0 0 6px}
.sub{color:var(--muted);font-size:14px;margin:0 0 16px;line-height:1.45}

.card{
  background:var(--card);border:1px solid var(--line);
  border-radius:16px;padding:14px;margin-bottom:14px
}
.topbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
.btnrow{display:flex;gap:10px;flex-wrap:wrap}
.btn{
  border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--text);
  padding:9px 12px;border-radius:12px;font-size:13px;cursor:pointer
}
.btn:hover{border-color:rgba(124,92,255,.35)}
.btn.danger{border-color:rgba(255,107,107,.35)}
.btn.danger:hover{border-color:rgba(255,107,107,.65)}

.section-title{font-size:15px;margin:0 0 10px}
.small{font-size:12px;color:var(--muted);font-weight:600}

.item{
  display:flex;gap:10px;align-items:flex-start;
  padding:10px;border-radius:12px;border:1px solid var(--line);
  margin-bottom:8px;background:rgba(0,0,0,.15)
}
input[type=checkbox]{width:18px;height:18px;margin-top:2px;accent-color:var(--accent)}
.desc{font-size:12px;color:var(--muted);margin-top:4px;line-height:1.4}

textarea{
  width:100%;min-height:120px;background:rgba(0,0,0,.2);
  border:1px solid var(--line);border-radius:12px;padding:10px;
  color:var(--text);font-size:13px;resize:vertical;line-height:1.5;outline:none
}

.progress{height:10px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden;margin-top:12px}
.bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--ok))}

.kpi{display:flex;gap:10px;margin-top:10px}
.kpi .box{
  flex:1;background:rgba(0,0,0,.2);border:1px solid var(--line);
  border-radius:12px;padding:10px
}
.num{font-size:22px;font-weight:800;margin-top:6px}

.listCard{
  border:1px solid var(--line);border-radius:12px;padding:10px;margin-top:10px;
  background:rgba(0,0,0,.12)
}
pre{white-space:pre-wrap;margin:8px 0 0;color:var(--text);font-family:inherit;font-size:13px;line-height:1.5}
footer{color:var(--muted);font-size:12px;margin-top:10px;line-height:1.5}

/* ===== ì£¼/ì›”/ë‹¬ë ¥ ===== */
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media (max-width:520px){.grid2{grid-template-columns:1fr}}

.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.statbox{
  padding:10px;border-radius:12px;border:1px solid var(--line);
  background:rgba(0,0,0,.12);
}
.statlabel{font-size:12px;color:var(--muted)}
.statnum{font-size:22px;font-weight:800;margin-top:6px}
.statdesc{font-size:12px;color:var(--muted);margin-top:6px}

.weekbars{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;align-items:end;height:90px;margin-top:8px}
.weekbars .barbox{
  border:1px solid var(--line);
  background:rgba(124,92,255,.18);
  border-radius:10px;
  position:relative;
  overflow:hidden;
}
.weekbars .barbox > i{
  display:block;width:100%;height:0%;
  background:linear-gradient(180deg, rgba(124,92,255,.9), rgba(61,220,151,.9));
}
.weekbars .barbox span{
  position:absolute;left:6px;bottom:6px;font-size:11px;color:rgba(233,238,255,.85)
}
.callabel{font-size:13px;color:var(--muted);font-weight:700}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:10px}
.calendar .dow{
  text-align:center;padding:6px 0;color:var(--muted);font-size:12px;font-weight:700
}
.calendar button.cell{
  border:1px solid var(--line);
  background:rgba(0,0,0,.10);
  border-radius:12px;
  padding:10px 8px;
  min-height:56px;
  color:var(--text);
  text-align:left;
  cursor:pointer;
}
.calendar button.cell:hover{border-color:rgba(124,92,255,.35)}
.calendar button.cell .d{font-size:12px;color:rgba(233,238,255,.85);font-weight:800}
.calendar button.cell .p{margin-top:6px;font-size:13px;font-weight:800;color:rgba(233,238,255,.95)}

/* ===== ëª¨ë‹¬ ===== */
.modalbackdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.55);
  display:flex;align-items:center;justify-content:center;padding:16px;z-index:9999;
}
.modal{
  width:min(720px,100%);background:var(--card);
  border:1px solid var(--line);border-radius:16px;padding:14px;
}
.journalview{
  border:1px solid var(--line);
  background:rgba(0,0,0,.18);
  border-radius:12px;
  padding:10px 12px;
  color:var(--text);
  white-space:pre-wrap;
  line-height:1.5;
  min-height:80px;
}
.errbox{
  display:none;
  position:fixed; left:12px; right:12px; bottom:12px;
  background:rgba(0,0,0,.75);
  border:1px solid rgba(255,107,107,.45);
  border-radius:12px;
  padding:10px 12px;
  color:#fff;
  z-index:99999;
  font-size:12px;
  line-height:1.4;
}
</style>
</head>

<body>

<div class="top">
  <button id="tabRoutine" class="tabbtn active" type="button">ğŸ—“ ë£¨í‹´</button>
  <button id="tabBeauty"  class="tabbtn" type="button">ğŸ’„ ë·°í‹°</button>
  <button id="tabAccount" class="tabbtn" type="button">ğŸ’° ê°€ê³„ë¶€</button>
</div>

<!-- ========================= ë£¨í‹´ ========================= -->
<div id="pageRoutine" class="page active">
  <div class="wrap">

    <div class="card">
      <div class="topbar">
        <div>
          <h1>ë‚˜ì˜ ì„ íƒê³¼ ì§‘ì¤‘ ëŒ€ì‹œë³´ë“œ</h1>
          <div class="sub">ì²´í¬/ì¼ê¸°/ë©”ëª¨ëŠ” ë‚ ì§œë³„ ì €ì¥ Â· ë‹¬ë ¥ì—ì„œ ë‚ ì§œ ì„ íƒ í›„ â€œì´ ë‚ ì§œ í¸ì§‘â€ ê°€ëŠ¥</div>
          <div class="small">í˜„ì¬ í¸ì§‘ ë‚ ì§œ: <span id="r_dateLabel"></span></div>
        </div>
        <div class="btnrow">
          <button class="btn" id="r_btnGoToday" type="button">ì˜¤ëŠ˜ë¡œ</button>
          <button class="btn" id="r_btnTodayReset" type="button">ì´ ë‚ ì§œë§Œ ë¦¬ì…‹</button>
          <button class="btn danger" id="r_btnClearAll" type="button">ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>

    <div class="card" id="r_am">
      <div class="section-title">ğŸŒ… ì•„ì¹¨ ë£¨í‹´</div>

      <div class="item"><input type="checkbox" data-key="med"><div><b>ë§ˆìŒì±™ê¹€ ëª…ìƒ</b><div class="desc">5~10ë¶„, ê·¸ëƒ¥ ì•‰ê¸°</div></div></div>

      <div class="item">
        <input type="checkbox" data-key="mind_positive">
        <div style="flex:1">
          <b>ê¸ì •ì  ìƒê°í•˜ê¸°</b>
          <div class="desc">ì˜¤ëŠ˜ ë– ì˜¬ë¦° ê¸ì •ì ì¸ ìƒê°(ë‚ ì§œë³„ ë©”ëª¨)</div>
          <textarea id="r_positiveMemo" placeholder="ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¢‹ì€ ìƒê° / ê°ì‚¬í•œ ê²ƒ" style="margin-top:6px;min-height:60px"></textarea>
        </div>
      </div>

      <div class="item"><input type="checkbox" data-key="run"><div><b>ëŸ¬ë‹/ë¹ ë¥¸ ê±·ê¸°</b><div class="desc">20~40ë¶„</div></div></div>
      <div class="item"><input type="checkbox" data-key="strength"><div><b>ê·¼ë ¥ìš´ë™ 20ë¶„</b></div></div>
      <div class="item"><input type="checkbox" data-key="dogwalk"><div><b>ê°•ì•„ì§€ ì‚°ì±…</b></div></div>

      <div class="item">
        <input type="checkbox" data-key="water500_am">
        <div>
          <b>ì•„ì¹¨ì— ë¬¼ 500ml ì„­ì·¨</b>
          <div class="desc">ê¸°ìƒ ì§í›„ ë¬¼ í•œ ì»µ ì´ìƒ</div>
        </div>
      </div>
    </div>

    <div class="card" id="r_pm">
      <div class="section-title">ğŸŒ™ ì €ë… ë£¨í‹´</div>

      <div class="item"><input type="checkbox" data-key="mind_noscroll"><div><b>ì‹œê°„ ë‚­ë¹„í•˜ì§€ ì•Šê¸°</b><div class="desc">ë¬´ì˜ì‹ ìŠ¤í¬ë¡¤ Â· ì˜ë¯¸ ì—†ëŠ” ì†Œë¹„ ì°¨ë‹¨</div></div></div>
      <div class="item"><input type="checkbox" data-key="mind_clean"><div><b>ì²­ì†Œí•˜ê¸°</b><div class="desc">ê³µê°„ ì •ë¦¬ Â· ì—ë„ˆì§€ ì •ë¦¬</div></div></div>
      <div class="item"><input type="checkbox" data-key="diet"><div><b>ì‹ë‹¨ ì¡°ì ˆ</b><div class="desc">ì ìƒ‰ìœ¡/ì†Œê¸ˆë¬¼/ë²„í„° ì„­ì·¨ ì˜ì‹</div></div></div>
      <div class="item"><input type="checkbox" data-key="save"><div><b>ì ˆì•½: ëˆ ì•ˆ ì“°ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="simplify"><div><b>ìƒí™œ ë‹¨ìˆœí™”: ë¶ˆí•„ìš” 1ê°œ ì‚­ì œ</b></div></div>
      <div class="item"><input type="checkbox" data-key="sleep8"><div><b>8ì‹œê°„ ì´ìƒ ìˆ˜ë©´</b><div class="desc">10ì‹œ ~ 6ì‹œ ëª©í‘œ</div></div></div>

      <div class="item">
        <input type="checkbox" data-key="accountbook">
        <div>
          <b>ê°€ê³„ë¶€ ì“°ê¸°</b>
          <div class="desc">ì˜¤ëŠ˜ ì§€ì¶œ Â· ìˆ˜ì… ê°„ë‹¨ ì •ë¦¬</div>
        </div>
      </div>

      <div class="item"><input type="checkbox" data-key="computer"><div><b>ì»´ ê°€ê¹Œì´ ë£¨í‹´ 1íšŒ</b><div class="desc">25ë¶„ ì§‘ì¤‘ + ê¸°ë¡</div></div></div>
      <div class="item"><input type="checkbox" data-key="lifeplan10"><div><b>ì¸ìƒ ê³„íš 10ë¶„</b></div></div>

      <div class="item">
        <input type="checkbox" data-key="esteem">
        <div style="flex:1">
          <b>ìì¡´ê° ì±„ìš°ê¸°</b>
          <div class="desc">ì˜¤ëŠ˜ ë‚´ê°€ ì˜í•œ ê²ƒ 1ê°€ì§€(ë‚ ì§œë³„ ë©”ëª¨)</div>
          <textarea id="r_esteemMemo" placeholder="ì˜¤ëŠ˜ì˜ ë‚˜ ì¹­ì°¬" style="margin-top:6px;min-height:60px"></textarea>
        </div>
      </div>
<div class="item">
  <input type="checkbox" data-key="vinegar_before_bed">
  <div>
    <b>ìê¸° ì „ ì‹ì´ˆë¬¼ í•œ ì»µ</b>
    <div class="desc">ì·¨ì¹¨ ì§ì „ ë£¨í‹´</div>
  </div>
</div>

<div class="item">
  <input type="checkbox" data-key="vitaminC_megadose">
  <div>
    <b>ë¹„íƒ€ë¯¼ C ë©”ê°€ë„ìŠ¤</b>
    <div class="desc">ê³ ìš©ëŸ‰ ë¹„íƒ€ë¯¼ C ì„­ì·¨ (ê°œì¸ ì»¨ë””ì…˜ ê¸°ì¤€)</div>
  </div>
</div>
      <div class="item"><input type="checkbox" data-key="eng"><div><b>ì˜ì–´ ì–´í”Œ 15ë¶„</b></div></div>
      <div class="item"><input type="checkbox" data-key="worksheet"><div><b>í•™ìŠµì§€ 1íšŒ</b></div></div>
      <div class="item"><input type="checkbox" data-key="friend"><div><b>ì™¸êµ­ì¸ ì¹œêµ¬ í–‰ë™ 1ê°œ</b><div class="desc">DM/ëª¨ì„ ì‹ ì²­/ë¬¸ì¥ ëŒ€í™” ë“± â€œí–‰ë™â€ë§Œ ì²´í¬</div></div></div>
      <div class="item"><input type="checkbox" data-key="dogcare"><div><b>ê°•ì•„ì§€ ì¼€ì–´</b><div class="desc">ì–‘ì¹˜(ë§¤ì¼) / ëª©ìš•Â·ìœ„ìƒ(í•„ìš”ì‹œ)</div></div></div>
    </div>

    <div class="card" id="r_diaryCard">
      <div class="section-title">ğŸ“– ì¼ê¸° (í˜„ì¬ í¸ì§‘ ë‚ ì§œë¡œ ì €ì¥)</div>
      <textarea id="r_journal" placeholder="1) ì˜¤ëŠ˜ í•œ ì¼&#10;2) ëŠë‚€ ì &#10;3) ë‚´ì¼ì˜ í•œ ê°€ì§€"></textarea>

      <div class="btnrow" style="margin-top:10px;justify-content:flex-end">
        <button class="btn" id="r_btnDiaryList" type="button">ğŸ“š ì¼ê¸° ê¸°ë¡ ë³´ê¸°</button>
        <button class="btn" id="r_btnDiaryExport" type="button">â¬‡ï¸ ë°±ì—…(JSON)</button>
      </div>
      <div id="r_diaryList" style="display:none;"></div>
    </div>

    <div class="card" id="r_lifePlanCard">
      <div class="section-title">ğŸ§­ ì¸ìƒ ê³„íš ê¸°ë¡ (í˜„ì¬ í¸ì§‘ ë‚ ì§œë¡œ ì €ì¥)</div>
      <textarea id="r_lifePlan" placeholder="ì¥ê¸° ëª©í‘œ / ì´ë²ˆ ë‹¬ ëª©í‘œ / ë°©í–¥ ì •ë¦¬"></textarea>

      <div class="btnrow" style="margin-top:10px;justify-content:flex-end">
        <button class="btn" id="r_btnLifePlanList" type="button">ğŸ“š ì¸ìƒ ê³„íš ê¸°ë¡ ë³´ê¸°</button>
        <button class="btn" id="r_btnLifePlanExport" type="button">â¬‡ï¸ ì¸ìƒ ê³„íš ë°±ì—…(JSON)</button>
      </div>
      <div id="r_lifePlanList" style="display:none;"></div>
    </div>

    <div class="card">
      <div class="progress"><div class="bar" id="r_bar"></div></div>
      <div class="kpi">
        <div class="box">í˜„ì¬ ë‚ ì§œ ì§„í–‰ë¥ <div class="num" id="r_percent">0%</div></div>
        <div class="box">ì™„ë£Œ í•­ëª©<div class="num"><span id="r_done">0</span>/<span id="r_total">0</span></div></div>
      </div>
    </div>

    <div class="card" id="r_analyticsCard">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="section-title" style="margin:0">ğŸ“ˆ ì£¼/ì›” ì§„í–‰ë¥ </div>
          <div class="small callabel" id="r_calLabel"></div>
        </div>
        <div class="btnrow">
          <button class="btn" id="r_btnPrevMonth" type="button">â—€ï¸</button>
          <button class="btn" id="r_btnThisMonth" type="button">ì´ë²ˆ ë‹¬</button>
          <button class="btn" id="r_btnNextMonth" type="button">â–¶ï¸</button>
        </div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div class="statbox">
          <div class="statlabel">ì´ë²ˆ ì£¼ í‰ê· </div>
          <div class="statnum" id="r_weekAvg">0%</div>
          <div class="statdesc" id="r_weekDays">ê¸°ë¡ 0ì¼</div>
        </div>
        <div class="statbox">
          <div class="statlabel">ì´ë²ˆ ë‹¬ í‰ê· </div>
          <div class="statnum" id="r_monthAvg">0%</div>
          <div class="statdesc" id="r_monthDays">ê¸°ë¡ 0ì¼</div>
        </div>
      </div>

      <div style="height:12px"></div>
      <div class="statlabel">ìµœê·¼ 7ì¼ ê·¸ë˜í”„</div>
      <div id="r_weekBars" class="weekbars"></div>

      <div style="height:14px"></div>
      <div class="statlabel">ì›”ê°„ ë‹¬ë ¥ (ë‚ ì§œ ëˆŒëŸ¬ì„œ ê¸°ë¡ ë³´ê¸° â†’ â€œì´ ë‚ ì§œ í¸ì§‘â€ ê°€ëŠ¥)</div>
      <div id="r_calGrid" class="calendar"></div>
    </div>

    <footer>
      âœ” ë°ì´í„°ëŠ” <b>ì´ ë¸Œë¼ìš°ì €(LocalStorage)</b>ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.<br/>
      âœ” â€œë°©ë¬¸ ê¸°ë¡ ë° ì›¹ ì‚¬ì´íŠ¸ ë°ì´í„° ì§€ìš°ê¸°â€ë¥¼ í•˜ë©´ ë°ì´í„°ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.<br/>
      âœ” ê·¸ë˜ì„œ â€œë°±ì—…(JSON)â€ì„ ê°€ë” ë°›ì•„ë‘ëŠ” ê±¸ ì¶”ì²œí•´ìš”.
    </footer>
  </div>

  <div id="r_dayModalBackdrop" class="modalbackdrop" style="display:none">
    <div class="modal">
      <div class="row" style="justify-content:space-between; align-items:center">
        <div>
          <div class="statlabel">ê¸°ë¡ ë³´ê¸°</div>
          <div class="statnum" id="r_dayModalTitle" style="font-size:18px">YYYY-MM-DD</div>
        </div>
        <div class="btnrow">
          <button class="btn" id="r_btnEditThisDay" type="button">ì´ ë‚ ì§œ í¸ì§‘</button>
          <button class="btn" id="r_btnCloseDayModal" type="button">ë‹«ê¸°</button>
        </div>
      </div>

      <div style="height:10px"></div>
      <div class="grid2">
        <div class="statbox">
          <div class="statlabel">ì§„í–‰ë¥ </div>
          <div class="statnum" id="r_dayModalPct">0%</div>
        </div>
        <div class="statbox">
          <div class="statlabel">ì™„ë£Œ</div>
          <div class="statnum"><span id="r_dayModalDone">0</span>/<span id="r_dayModalTotal">0</span></div>
        </div>
      </div>

      <div style="height:12px"></div>
      <div class="statlabel">ğŸ“ ê·¸ë‚ ì˜ ê¸°ë¡</div>
      <div id="r_dayModalJournal" class="journalview">(ê¸°ë¡ ì—†ìŒ)</div>

      <div style="height:12px"></div>
      <div class="statlabel">ğŸ§­ ê·¸ë‚ ì˜ ì¸ìƒ ê³„íš</div>
      <div id="r_dayModalLifePlan" class="journalview">(ê¸°ë¡ ì—†ìŒ)</div>
    </div>
  </div>
</div>

<!-- ========================= ë·°í‹° ========================= -->
<div id="pageBeauty" class="page">
  <div class="wrap">

    <div class="card">
      <div class="topbar">
        <div>
          <h1>ì™¸ëª¨ ê°€ê¾¸ê¸° ì§‘ì¤‘ ëŒ€ì‹œë³´ë“œ</h1>
          <div class="sub">ì²´í¬/ë©”ëª¨ ìë™ ì €ì¥(ë‚ ì§œë³„) Â· ë‹¬ë ¥ì—ì„œ ë‚ ì§œ ì„ íƒ í›„ â€œì´ ë‚ ì§œ í¸ì§‘â€ ê°€ëŠ¥</div>
          <div class="small">í˜„ì¬ í¸ì§‘ ë‚ ì§œ: <span id="b_dateLabel"></span></div>
        </div>
        <div class="btnrow">
          <button class="btn" id="b_btnGoToday" type="button">ì˜¤ëŠ˜ë¡œ</button>
          <button class="btn" id="b_btnTodayReset" type="button">ì´ ë‚ ì§œë§Œ ë¦¬ì…‹</button>
          <button class="btn danger" id="b_btnClearAll" type="button">ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>

    <div class="card" id="b_diet">
      <div class="section-title">ğŸ½ ì‹ë‹¨</div>
      <div class="item"><input type="checkbox" data-key="diet_redmeat"><div><b>ì ìƒ‰ìœ¡ ë¨¹ê¸°</b><div class="desc">ì˜¤ëŠ˜ ì„­ì·¨ ì²´í¬(ê¸°ë¡ìš©)</div></div></div>
      <div class="item"><input type="checkbox" data-key="diet_omad"><div><b>1ì¼ 1ì‹ í•˜ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="diet_saltwater"><div><b>ì†Œê¸ˆë¬¼ ë¨¹ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="diet_butter"><div><b>ë²„í„° ë¨¹ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="diet_noprocess"><div><b>ê°€ê³µì‹í’ˆ ì•ˆ ë¨¹ê¸°</b><div class="desc">ê°€ê³µì‹í’ˆ 0íšŒ ëª©í‘œ</div></div></div>
      <div class="item"><input type="checkbox" data-key="diet_water"><div><b>ë¬¼ 1~2L ì„­ì·¨</b></div></div>
    </div>

    <div class="card" id="b_skin">
      <div class="section-title">âœ¨ ìŠ¤í‚¨ì¼€ì–´</div>
      <div class="item"><input type="checkbox" data-key="skin_cleanse"><div><b>ë§¤ì¼ ì„¸ì•ˆ & ìŠ¤í‚¨ë¥˜ ê¼¼ê¼¼íˆ ë°”ë¥´ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="skin_mask_alt"><div><b>ê²©ì¼ íŒ©í•˜ê¸°</b><div class="desc">ìˆ˜ë¶„íŒ© / ê°ì§ˆíŒ© / ëª¨ê³µíŒ© ì¤‘ 1</div></div></div>
      <div class="item"><input type="checkbox" data-key="skin_device"><div><b>ë””ë°”ì´ìŠ¤ ì´ìš©í•˜ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="skin_lifting_week"><div><b>ë¦¬í”„íŒ… ë””ë°”ì´ìŠ¤(ì£¼ 1íšŒ)</b><div class="desc">ì£¼ 1íšŒë©´ ì²´í¬(ìš”ì¼ ìƒê´€ì—†ìŒ)</div></div></div>
      <div class="item"><input type="checkbox" data-key="skin_hair_sun"><div><b>ì¼ìš”ì¼ í—¤ì–´ íŠ¸ë¦¬íŠ¸ë¨¼íŠ¸ í•˜ê¸°</b><div class="desc">ì¼ìš”ì¼ì—ë§Œ ì²´í¬í•´ë„ OK</div></div></div>
      <div class="item"><input type="checkbox" data-key="skin_sleep8"><div><b>8ì‹œê°„ ì´ìƒ ìˆ˜ë©´</b><div class="desc">10ì‹œ~6ì‹œ ëª©í‘œ</div></div></div>
    </div>

    <div class="card" id="b_body">
      <div class="section-title">ğŸ§´ ë°”ë””</div>
      <div class="item"><input type="checkbox" data-key="body_lotion"><div><b>ë°”ë””ë¡œì…˜ & ì˜¤ì¼ ë§¤ì¼ ë°”ë¥´ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="body_calf"><div><b>ì¢…ì•„ë¦¬ ë§ˆì‚¬ì§€í•˜ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="body_masseur"><div><b>ì „ì‹  ì•ˆë§ˆê¸° ì‚¬ìš©í•˜ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="body_head"><div><b>ë¨¸ë¦¬ ì§€ì•• ë§ˆì‚¬ì§€ í•˜ê¸°</b></div></div>
    </div>

    <div class="card" id="b_fit">
      <div class="section-title">ğŸ‹ï¸ í—¬ìŠ¤</div>
      <div class="item"><input type="checkbox" data-key="fit_stretch"><div><b>ìŠ¤íŠ¸ë ˆì¹­í•˜ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="fit_strength"><div><b>ê·¼ë ¥ìš´ë™ í•˜ê¸°</b><div class="desc">ìŠ¤ì¿¼íŠ¸/í—ˆë¦¬/íŒ” ë¤ë²¨/í—ˆë²…ì§€ ì•ˆìª½</div></div></div>
      <div class="item"><input type="checkbox" data-key="fit_cardio"><div><b>ìœ ì‚°ì†Œ í•˜ê¸°</b><div class="desc">ìì „ê±° & ë§ˆì´ë§ˆìš´í‹´ & ì¡°ê¹…</div></div></div>
    </div>

    <div class="card" id="b_mind">
      <div class="section-title">ğŸ§  ë§ˆì¸ë“œì»¨íŠ¸ë¡¤</div>
      <div class="item"><input type="checkbox" data-key="mind_selfie10"><div><b>í•˜ë£¨ ì…€ì¹´ 10ì¥ ì´ìƒ ì°ê¸°</b><div class="desc">í‘œì •/ê°ë„/í”¼ë¶€ ì²´í¬</div></div></div>
      <div class="item"><input type="checkbox" data-key="mind_read10"><div><b>ì±… 10ë¶„ ì´ìƒ ì½ê¸°</b><div class="desc">í•œë‹¬ 2ê¶Œ ì´ìƒ ëª©í‘œ</div></div></div>
      <div class="item"><input type="checkbox" data-key="mind_image"><div><b>ë‚´ê°€ ë˜ê³  ì‹¶ì€ ì´ë¯¸ì§€ ìƒìƒí•˜ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="mind_ideal"><div><b>ë‚´ê°€ ë§Œë‚˜ê³  ì‹¶ì€ ì´ìƒí˜• ìƒìƒí•˜ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="mind_future"><div><b>ë‚´ê°€ ë˜ê³  ì‹¶ì€ ì™¸ëª¨ê°€ ë˜ì—ˆì„ ë•Œ ë¬´ì—‡ì„ í• ì§€ ìƒìƒí•˜ê¸°</b></div></div>
      <div class="item"><input type="checkbox" data-key="mind_inner"><div><b>ì™¸ë©´ë§Œí¼ ë‚´ë©´ í‚¤ìš°ê¸°</b><div class="desc">ë…ì„œ & êµì–‘(ì˜ìƒ/ê°•ì˜/ê¸°ì‚¬ë„ OK)</div></div></div>
      <div class="item"><input type="checkbox" data-key="mind_trip"><div><b>í•œë‹¬ì— 1~2íšŒ ì—¬í–‰ê°€ê¸°</b><div class="desc">ë‹¹ì¼ì¹˜ê¸°/ê·¼êµ/ì§§ì€ ì—¬í–‰ë„ OK</div></div></div>
    </div>

    <div class="card" id="b_memoCard">
      <div class="section-title">ğŸ“ ëª¸ìƒíƒœ ë©”ëª¨ (í˜„ì¬ í¸ì§‘ ë‚ ì§œë¡œ ì €ì¥)</div>
      <textarea id="b_journal" placeholder="ì˜ˆ) ì»¨ë””ì…˜/ìˆ˜ë©´/í”¼ë¶€ìƒíƒœ/ë¶“ê¸°/ê·¼ìœ¡í†µ/ê¸°ë¶„/ì‹ë‹¨ ë§Œì¡±ë„ ë“±"></textarea>

      <div class="btnrow" style="margin-top:10px;justify-content:flex-end">
        <button class="btn" id="b_btnDiaryList" type="button">ğŸ“š ë©”ëª¨ ê¸°ë¡ ë³´ê¸°</button>
        <button class="btn" id="b_btnDiaryExport" type="button">â¬‡ï¸ ë°±ì—…(JSON)</button>
      </div>
      <div id="b_diaryList" style="display:none;"></div>
    </div>

    <div class="card">
      <div class="progress"><div class="bar" id="b_bar"></div></div>
      <div class="kpi">
        <div class="box">í˜„ì¬ ë‚ ì§œ ì§„í–‰ë¥ <div class="num" id="b_percent">0%</div></div>
        <div class="box">ì™„ë£Œ í•­ëª©<div class="num"><span id="b_done">0</span>/<span id="b_total">0</span></div></div>
      </div>
    </div>

    <div class="card" id="b_analyticsCard">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="section-title" style="margin:0">ğŸ“ˆ ì£¼/ì›” ì§„í–‰ë¥ </div>
          <div class="small callabel" id="b_calLabel"></div>
        </div>
        <div class="btnrow">
          <button class="btn" id="b_btnPrevMonth" type="button">â—€ï¸</button>
          <button class="btn" id="b_btnThisMonth" type="button">ì´ë²ˆ ë‹¬</button>
          <button class="btn" id="b_btnNextMonth" type="button">â–¶ï¸</button>
        </div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div class="statbox">
          <div class="statlabel">ì´ë²ˆ ì£¼ í‰ê· </div>
          <div class="statnum" id="b_weekAvg">0%</div>
          <div class="statdesc" id="b_weekDays">ê¸°ë¡ 0ì¼</div>
        </div>
        <div class="statbox">
          <div class="statlabel">ì´ë²ˆ ë‹¬ í‰ê· </div>
          <div class="statnum" id="b_monthAvg">0%</div>
          <div class="statdesc" id="b_monthDays">ê¸°ë¡ 0ì¼</div>
        </div>
      </div>

      <div style="height:12px"></div>
      <div class="statlabel">ìµœê·¼ 7ì¼ ê·¸ë˜í”„</div>
      <div id="b_weekBars" class="weekbars"></div>

      <div style="height:14px"></div>
      <div class="statlabel">ì›”ê°„ ë‹¬ë ¥ (ë‚ ì§œ ëˆŒëŸ¬ì„œ ê¸°ë¡ ë³´ê¸° â†’ â€œì´ ë‚ ì§œ í¸ì§‘â€ ê°€ëŠ¥)</div>
      <div id="b_calGrid" class="calendar"></div>
    </div>

    <footer>
      âœ” ë·°í‹° ì²´í¬/ë©”ëª¨ ë°ì´í„°ëŠ” <b>ì´ ë¸Œë¼ìš°ì €(LocalStorage)</b>ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.<br/>
      âœ” â€œë°©ë¬¸ ê¸°ë¡ ë° ì›¹ ì‚¬ì´íŠ¸ ë°ì´í„° ì§€ìš°ê¸°â€ë¥¼ í•˜ë©´ ë°ì´í„°ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤ â†’ â€œë°±ì—…(JSON)â€ ì¶”ì²œ.
    </footer>
  </div>

  <div id="b_dayModalBackdrop" class="modalbackdrop" style="display:none">
    <div class="modal">
      <div class="row" style="justify-content:space-between; align-items:center">
        <div>
          <div class="statlabel">ê¸°ë¡ ë³´ê¸°</div>
          <div class="statnum" id="b_dayModalTitle" style="font-size:18px">YYYY-MM-DD</div>
        </div>
        <div class="btnrow">
          <button class="btn" id="b_btnEditThisDay" type="button">ì´ ë‚ ì§œ í¸ì§‘</button>
          <button class="btn" id="b_btnCloseDayModal" type="button">ë‹«ê¸°</button>
        </div>
      </div>

      <div style="height:10px"></div>
      <div class="grid2">
        <div class="statbox">
          <div class="statlabel">ì§„í–‰ë¥ </div>
          <div class="statnum" id="b_dayModalPct">0%</div>
        </div>
        <div class="statbox">
          <div class="statlabel">ì™„ë£Œ</div>
          <div class="statnum"><span id="b_dayModalDone">0</span>/<span id="b_dayModalTotal">0</span></div>
        </div>
      </div>

      <div style="height:12px"></div>
      <div class="statlabel">ğŸ“ ê·¸ë‚  ëª¸ìƒíƒœ ë©”ëª¨</div>
      <div id="b_dayModalJournal" class="journalview">(ê¸°ë¡ ì—†ìŒ)</div>
    </div>
  </div>
</div>
<!-- ========================= ê°€ê³„ë¶€ ========================= -->
<div id="pageAccount" class="page">
  <div class="wrap">

    <div class="card">
      <div class="topbar">
        <div>
          <h1>ê°€ê³„ë¶€ ëŒ€ì‹œë³´ë“œ</h1>
          <div class="sub">ìˆ˜ì…/ì§€ì¶œì„ ë‚ ì§œë³„ë¡œ ê¸°ë¡ Â· (ì €ì¥ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì—°ê²°)</div>
          <div class="small">í˜„ì¬ í¸ì§‘ ë‚ ì§œ: <span id="a_dateLabel"></span></div>
        </div>
        <div class="btnrow">
          <button class="btn" id="a_btnGoToday" type="button">ì˜¤ëŠ˜ë¡œ</button>
          <button class="btn danger" id="a_btnClearAll" type="button">ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="section-title">â• ìˆ˜ì…/ì§€ì¶œ ì¶”ê°€</div>

      <div class="row" style="gap:8px">
        <select id="a_type" class="btn" style="padding:10px 12px">
          <option value="expense">ì§€ì¶œ</option>
          <option value="income">ìˆ˜ì…</option>
        </select>

        <input id="a_amount" class="btn" type="number" placeholder="ê¸ˆì•¡" style="flex:1; padding:10px 12px" />
        <input id="a_memo" class="btn" type="text" placeholder="ë©”ëª¨(ì˜ˆ: ì»¤í”¼, ì›”ê¸‰)" style="flex:2; padding:10px 12px" />

        <button class="btn" id="a_btnAdd" type="button">ì¶”ê°€</button>
      </div>

      <div class="small" style="margin-top:10px;color:var(--muted)">
        * ì§€ê¸ˆì€ í™”ë©´ë§Œ ì¶”ê°€ëœ ìƒíƒœì•¼. ì €ì¥/ì›”ë³„ ì •ì‚°ì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì—°ê²°í• ê²Œ.
      </div>
    </div>

    <div class="card">
      <div class="section-title">ğŸ“’ ì˜¤ëŠ˜(ì„ íƒ ë‚ ì§œ) ë‚´ì—­</div>
      <div id="a_list" class="listCard">
        <div class="small">ì•„ì§ ë‚´ì—­ì´ ì—†ì–´ìš”.</div>
      </div>
    </div>

    <div class="card">
      <div class="section-title">ğŸ“Š ì›”ë³„ í•©ê³„(ë¯¸ì—°ê²°)</div>
      <div class="grid2">
        <div class="statbox">
          <div class="statlabel">ì´ë²ˆ ë‹¬ ìˆ˜ì…</div>
          <div class="statnum" id="a_monthIncome">0</div>
        </div>
        <div class="statbox">
          <div class="statlabel">ì´ë²ˆ ë‹¬ ì§€ì¶œ</div>
          <div class="statnum" id="a_monthExpense">0</div>
        </div>
      </div>
      <div class="statdesc" style="margin-top:10px">
        (ì›”ë³„ ì •ì‚°/ì €ì¥ ë¡œì§ ë¶™ì´ë©´ ìë™ ê³„ì‚°ë˜ê²Œ ë§Œë“¤ ê±°ì•¼)
      </div>
    </div>

    <footer>
      âœ” ê°€ê³„ë¶€ë„ ë£¨í‹´/ë·°í‹°ì²˜ëŸ¼ ë¸Œë¼ìš°ì €(LocalStorage)ì— ì €ì¥ë˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆì–´.<br/>
      âœ” ë‹¤ìŒ ë‹¨ê³„ì—ì„œ â€œì €ì¥ + ì›”ë³„ ì •ì‚° + ë°±ì—…(JSON)â€ê¹Œì§€ ë¶™ì—¬ì¤„ê²Œ.
    </footer>
  </div>
</div>
<!-- ========================= /ê°€ê³„ë¶€ ë ========================= -->
<div id="errbox" class="errbox"></div>

<script>
/* ===== ì—ëŸ¬ê°€ ë‚˜ë©´ í•˜ì–€ í™”ë©´ ëŒ€ì‹  ì´ìœ ë¥¼ ë³´ì—¬ì£¼ê¸° (ì‚¬íŒŒë¦¬ì—ì„œ ë„ì›€ë¨) ===== */
window.addEventListener("error", (e)=>{
  const box = document.getElementById("errbox");
  if(!box) return;
  box.style.display = "block";
  box.textContent = "âš ï¸ ìŠ¤í¬ë¦½íŠ¸ ì—ëŸ¬: " + (e.message || e.error || "ì•Œ ìˆ˜ ì—†ìŒ");
});

/* ================== íƒ­ ì „í™˜ ================== */
const tabRoutine = document.getElementById("tabRoutine");
const tabBeauty  = document.getElementById("tabBeauty");
const pageRoutine = document.getElementById("pageRoutine");
const pageBeauty  = document.getElementById("pageBeauty");

function showRoutine(){
  pageRoutine.classList.add("active");
  pageBeauty.classList.remove("active");
  tabRoutine.classList.add("active");
  tabBeauty.classList.remove("active");
  window.scrollTo(0,0);
}
function showBeauty(){
  pageBeauty.classList.add("active");
  pageRoutine.classList.remove("active");
  tabBeauty.classList.add("active");
  tabRoutine.classList.remove("active");
  window.scrollTo(0,0);
}
tabRoutine.addEventListener("click", showRoutine);
tabBeauty.addEventListener("click", showBeauty);

/* ============== ê³µìš© ëŒ€ì‹œë³´ë“œ (prefix ê¸°ë°˜) ============== */
function createDashboard(prefix, storageKey){
  const todayKey = () => {
    const d = new Date();
    d.setMinutes(d.getMinutes() - d.getTimezoneOffset());
    return d.toISOString().slice(0, 10);
  };

  const pad2 = n => String(n).padStart(2,"0");
  const ymd  = d => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  const sameDay = (a,b) => a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate();
  const escapeHtml = s => (s||"").replace(/</g,"&lt;");

  function load(){
    try { return JSON.parse(localStorage.getItem(storageKey) || "{}"); }
    catch(e){ return {}; }
  }
  function save(v){ localStorage.setItem(storageKey, JSON.stringify(v)); }

  const state = load();
  if(!state.daily) state.daily = {};
  if(!state.journals) state.journals = {};
  if(!state.lifePlans) state.lifePlans = {};
  if(!state.positiveMemos) state.positiveMemos = {}; // ë£¨í‹´ ì „ìš©
  if(!state.esteemMemos) state.esteemMemos = {};   // ë£¨í‹´ ì „ìš©

  function pageRoot(){
    return document.getElementById(prefix==="r" ? "pageRoutine" : "pageBeauty");
  }
  function boxes(){
    return Array.from(pageRoot().querySelectorAll('input[type=checkbox][data-key]'));
  }
  function keysList(){ return boxes().map(b => b.dataset.key); }

  // âœ… í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ë‚ ì§œ
  let activeDate = todayKey();
  if(!state.daily[activeDate]) state.daily[activeDate] = {};

  const dateLabel = document.getElementById(prefix+"_dateLabel");
  const journal = document.getElementById(prefix+"_journal");
  const lifePlan = document.getElementById(prefix+"_lifePlan");

  // ë£¨í‹´ ì „ìš© ë©”ëª¨ í…ìŠ¤íŠ¸ì—ì–´ë¦¬ì–´
  const positiveMemo = (prefix==="r") ? document.getElementById("r_positiveMemo") : null;
  const esteemMemo   = (prefix==="r") ? document.getElementById("r_esteemMemo") : null;

  function updateProgress(){
    const b = boxes();
    const total = b.length;
    const done  = b.filter(x => x.checked).length;
    const pct   = total ? Math.round(done/total*100) : 0;

    const doneEl = document.getElementById(prefix+"_done");
    const totEl  = document.getElementById(prefix+"_total");
    const pctEl  = document.getElementById(prefix+"_percent");
    const barEl  = document.getElementById(prefix+"_bar");

    if(doneEl) doneEl.textContent = done;
    if(totEl)  totEl.textContent  = total;
    if(pctEl)  pctEl.textContent  = pct + "%";
    if(barEl)  barEl.style.width  = pct + "%";
  }

  function setActiveDate(dateStr){
    activeDate = dateStr;
    if(!state.daily[activeDate]) state.daily[activeDate] = {};

    if(dateLabel) dateLabel.textContent = activeDate;

    // ì²´í¬ë°•ìŠ¤ ë¡œë“œ
    boxes().forEach(b=>{
      const k = b.dataset.key;
      b.checked = !!(state.daily[activeDate] && state.daily[activeDate][k]);
    });

    // í…ìŠ¤íŠ¸ ë¡œë“œ
    if(journal) journal.value = state.journals[activeDate] || "";
    if(lifePlan) lifePlan.value = state.lifePlans[activeDate] || "";

    if(prefix==="r"){
      if(positiveMemo) positiveMemo.value = state.positiveMemos[activeDate] || "";
      if(esteemMemo) esteemMemo.value = state.esteemMemos[activeDate] || "";
    }

    updateProgress();
  }

  // âœ… ì´ˆê¸° ë¡œë“œ
  setActiveDate(activeDate);

  // ì²´í¬ë°•ìŠ¤ ë°”ì¸ë”©
  boxes().forEach(b=>{
    const k = b.dataset.key;
    b.addEventListener("change", ()=>{
      state.daily[activeDate][k] = b.checked;
      save(state);
      updateProgress();
      renderAnalytics();
    });
  });

  // ì¼ê¸°/ë©”ëª¨ ì €ì¥
  if(journal){
    journal.addEventListener("input", ()=>{
      state.journals[activeDate] = journal.value;
      save(state);
    });
  }

  // ì¸ìƒ ê³„íš ì €ì¥(ë£¨í‹´ë§Œ ì¡´ì¬)
  if(lifePlan){
    lifePlan.addEventListener("input", ()=>{
      state.lifePlans[activeDate] = lifePlan.value;
      save(state);
    });
  }

  // ê¸ì •/ìì¡´ê° ë©”ëª¨ ì €ì¥ (ë£¨í‹´ë§Œ)
  if(prefix==="r" && positiveMemo){
    positiveMemo.addEventListener("input", ()=>{
      state.positiveMemos[activeDate] = positiveMemo.value;
      save(state);
    });
  }
  if(prefix==="r" && esteemMemo){
    esteemMemo.addEventListener("input", ()=>{
      state.esteemMemos[activeDate] = esteemMemo.value;
      save(state);
    });
  }

  // ëª©ë¡ ë Œë”
  function renderTextList(targetId, mapObj, kindLabel){
    const box = document.getElementById(targetId);
    if(!box) return;

    const entries = Object.entries(mapObj || {})
      .filter(([d, txt]) => (txt||"").trim().length > 0)
      .sort((a,b)=> b[0].localeCompare(a[0]));

    if(entries.length === 0){
      box.innerHTML = `<div class="small">ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ì–´ìš”.</div>`;
      return;
    }

    box.innerHTML = entries.map(([d, txt]) => `
      <div class="listCard">
        <div class="topbar" style="padding:0;margin:0;border:0">
          <b>${d}</b>
          <button class="btn danger" type="button" data-del="${d}">ì‚­ì œ</button>
        </div>
        <pre>${escapeHtml(txt)}</pre>
      </div>
    `).join("");

    box.querySelectorAll("button[data-del]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const d = btn.getAttribute("data-del");
        if(!confirm(`${d} ${kindLabel} ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?`)) return;
        delete mapObj[d];
        save(state);
        renderTextList(targetId, mapObj, kindLabel);
        renderAnalytics();
      });
    });
  }

  // ë¦¬ìŠ¤íŠ¸ ë²„íŠ¼
  const btnDiaryList = document.getElementById(prefix+"_btnDiaryList");
  if(btnDiaryList){
    btnDiaryList.addEventListener("click", ()=>{
      const box = document.getElementById(prefix+"_diaryList");
      const open = box.style.display !== "none";
      box.style.display = open ? "none" : "block";
      if(!open) renderTextList(prefix+"_diaryList", state.journals, "ì¼ê¸°/ë©”ëª¨");
    });
  }

  // ë°±ì—…(JSON)
  const btnDiaryExport = document.getElementById(prefix+"_btnDiaryExport");
  if(btnDiaryExport){
    btnDiaryExport.addEventListener("click", ()=>{
      const blob = new Blob([JSON.stringify(state, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = (prefix==="r" ? "routine" : "beauty") + "-dashboard-backup.json";
      a.click();
      URL.revokeObjectURL(a.href);
    });
  }

  // ì¸ìƒ ê³„íš ë¦¬ìŠ¤íŠ¸/ë°±ì—…(ë£¨í‹´ë§Œ)
  const btnLPList = document.getElementById(prefix+"_btnLifePlanList");
  if(btnLPList){
    btnLPList.addEventListener("click", ()=>{
      const box = document.getElementById(prefix+"_lifePlanList");
      const open = box.style.display !== "none";
      box.style.display = open ? "none" : "block";
      if(!open) renderTextList(prefix+"_lifePlanList", state.lifePlans, "ì¸ìƒ ê³„íš");
    });
  }
  const btnLPExport = document.getElementById(prefix+"_btnLifePlanExport");
  if(btnLPExport){
    btnLPExport.addEventListener("click", ()=>{
      const data = { lifePlans: state.lifePlans || {} };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "lifeplan-backup.json";
      a.click();
      URL.revokeObjectURL(a.href);
    });
  }

  // ì˜¤ëŠ˜ë¡œ
  const btnGoToday = document.getElementById(prefix+"_btnGoToday");
  if(btnGoToday){
    btnGoToday.addEventListener("click", ()=>{
      setActiveDate(todayKey());
      renderAnalytics();
      window.scrollTo(0,0);
    });
  }

  // í˜„ì¬ ë‚ ì§œ(=activeDate)ë§Œ ë¦¬ì…‹
  const btnTodayReset = document.getElementById(prefix+"_btnTodayReset");
  if(btnTodayReset){
    btnTodayReset.addEventListener("click", ()=>{
      if(!confirm("í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ë‚ ì§œì˜ ì²´í¬/ê¸°ë¡ë§Œ ë¦¬ì…‹í• ê¹Œìš”?")) return;

      state.daily[activeDate] = {};
      state.journals[activeDate] = "";
      if(state.lifePlans) state.lifePlans[activeDate] = "";
      if(prefix==="r"){
        state.positiveMemos[activeDate] = "";
        state.esteemMemos[activeDate] = "";
      }
      save(state);

      setActiveDate(activeDate);
      renderAnalytics();
    });
  }

  // ì „ì²´ ì´ˆê¸°í™”
  const btnClearAll = document.getElementById(prefix+"_btnClearAll");
  if(btnClearAll){
    btnClearAll.addEventListener("click", ()=>{
      if(!confirm("ì „ì²´ ë°ì´í„°(ì²´í¬/ê¸°ë¡)ë¥¼ ëª¨ë‘ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
      localStorage.removeItem(storageKey);
      location.reload();
    });
  }

  function progressOf(dateStr){
    const keys = keysList();
    const daily = (state.daily && state.daily[dateStr]) ? state.daily[dateStr] : {};
    const total = keys.length;
    const done  = keys.filter(k => !!daily[k]).length;
    const pct   = total ? Math.round(done/total*100) : 0;
    const hasData = daily && Object.keys(daily).length > 0;
    return { total, done, pct, hasData };
  }

  function startOfWeekMonday(d){
    const day = d.getDay(); // 0 ì¼ ~ 6 í† 
    const diff = (day === 0) ? -6 : (1 - day);
    const s = new Date(d);
    s.setDate(s.getDate() + diff);
    s.setHours(0,0,0,0);
    return s;
  }

  function weekStats(){
    const today = new Date();
    const start = startOfWeekMonday(today);
    let sum = 0, count = 0;
    for(let i=0;i<7;i++){
      const d = new Date(start);
      d.setDate(start.getDate()+i);
      const ds = ymd(d);
      const p = progressOf(ds);
      sum += p.pct;
      if(p.hasData) count++;
    }
    return { avg: Math.round(sum/7), count };
  }

  let calYear = new Date().getFullYear();
  let calMonth0 = new Date().getMonth();

  function monthStats(year, month0){
    const last = new Date(year, month0+1, 0);
    let sum = 0;
    let cntDaysWithData = 0;
    for(let day=1; day<=last.getDate(); day++){
      const ds = ymd(new Date(year, month0, day));
      const p = progressOf(ds);
      sum += p.pct;
      if(p.hasData) cntDaysWithData++;
    }
    return { avg: Math.round(sum / last.getDate()), cntDaysWithData };
  }

  function renderWeekBars(){
    const el = document.getElementById(prefix+"_weekBars");
    if(!el) return;
    const today = new Date();
    const parts = [];
    for(let i=6;i>=0;i--){
      const d = new Date(today);
      d.setDate(today.getDate()-i);
      const ds = ymd(d);
      const p = progressOf(ds);
      const isToday = (ds === todayKey());
      parts.push(`
        <div class="barbox" title="${ds} (${p.pct}%)" style="${isToday ? "box-shadow:0 0 0 2px rgba(124,92,255,.25) inset" : ""}">
          <i style="height:${p.pct}%;"></i>
          <span>${ds.slice(8,10)}ì¼</span>
        </div>
      `);
    }
    el.innerHTML = parts.join("");
  }

  function renderCalendar(){
    const grid = document.getElementById(prefix+"_calGrid");
    const label = document.getElementById(prefix+"_calLabel");
    if(!grid || !label) return;

    label.textContent = `ì›”ê°„ ë‹¬ë ¥ Â· ${calYear}-${pad2(calMonth0+1)}`;

    const first = new Date(calYear, calMonth0, 1);
    const last  = new Date(calYear, calMonth0+1, 0);
    const startDow = first.getDay(); // 0 Sun
    const dows = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];

    const cells = [];
    for(const d of dows){ cells.push(`<div class="dow">${d}</div>`); }
    for(let i=0;i<startDow;i++){
      cells.push(`<div style="min-height:56px;opacity:.25;border:1px solid rgba(255,255,255,.06);border-radius:12px"></div>`);
    }

    const today = new Date();
    for(let day=1; day<=last.getDate(); day++){
      const d = new Date(calYear, calMonth0, day);
      const ds = ymd(d);
      const p = progressOf(ds);
      const alpha = 0.10 + (p.pct/100)*0.35;
      const isToday = sameDay(d,today);

      cells.push(`
        <button type="button" class="cell" data-date="${ds}"
          style="background:rgba(124,92,255,${alpha}); ${isToday ? "box-shadow:0 0 0 2px rgba(124,92,255,.25) inset;border-color:rgba(124,92,255,.55)" : ""}">
          <div class="d">${day}ì¼</div>
          <div class="p">${p.pct}%</div>
        </button>
      `);
    }

    grid.innerHTML = cells.join("");
    grid.querySelectorAll("button[data-date]").forEach(btn=>{
      btn.addEventListener("click", ()=> openDayModal(btn.getAttribute("data-date")));
    });
  }

  function openDayModal(dateStr){
    const back = document.getElementById(prefix+"_dayModalBackdrop");
    const title = document.getElementById(prefix+"_dayModalTitle");
    const pctEl = document.getElementById(prefix+"_dayModalPct");
    const doneEl = document.getElementById(prefix+"_dayModalDone");
    const totalEl = document.getElementById(prefix+"_dayModalTotal");

    if(!back || !title || !pctEl || !doneEl || !totalEl) return;

    const p = progressOf(dateStr);
    title.textContent = `ğŸ“… ${dateStr}`;
    pctEl.textContent = `${p.pct}%`;
    doneEl.textContent = p.done;
    totalEl.textContent = p.total;

    // ë£¨í‹´/ë·°í‹° ëª¨ë‹¬ ë‚´ìš© ì˜ì—­
    const modalJournal = document.getElementById(prefix+"_dayModalJournal");
    if(modalJournal){
      let txt = (state.journals && state.journals[dateStr]) ? state.journals[dateStr] : "(ê¸°ë¡ ì—†ìŒ)";

      if(prefix==="r"){
        const pos = state.positiveMemos?.[dateStr] || "";
        const est = state.esteemMemos?.[dateStr] || "";
        if(pos.trim()) txt += "\n\nğŸŒ± ê¸ì •ì  ìƒê°\n" + pos.trim();
        if(est.trim()) txt += "\n\nğŸ’– ìì¡´ê° ë©”ëª¨\n" + est.trim();
      }
      modalJournal.textContent = txt;
    }

    const lifePlanModal = document.getElementById(prefix+"_dayModalLifePlan");
    if(lifePlanModal){
      lifePlanModal.textContent = (state.lifePlans && state.lifePlans[dateStr]) ? state.lifePlans[dateStr] : "(ê¸°ë¡ ì—†ìŒ)";
    }

    const editBtn = document.getElementById(prefix+"_btnEditThisDay");
    if(editBtn){
      editBtn.onclick = ()=>{
        setActiveDate(dateStr);
        closeDayModal();
        window.scrollTo(0,0);
      };
    }

    back.style.display = "flex";
  }

  function closeDayModal(){
    const back = document.getElementById(prefix+"_dayModalBackdrop");
    if(back) back.style.display = "none";
  }

  const btnClose = document.getElementById(prefix+"_btnCloseDayModal");
  if(btnClose) btnClose.addEventListener("click", closeDayModal);

  const back = document.getElementById(prefix+"_dayModalBackdrop");
  if(back){
    back.addEventListener("click", (e)=>{
      if(e.target && e.target.id === (prefix+"_dayModalBackdrop")) closeDayModal();
    });
  }

  // ë‹¬ë ¥ ì›” ì´ë™
  const btnPrev = document.getElementById(prefix+"_btnPrevMonth");
  const btnNext = document.getElementById(prefix+"_btnNextMonth");
  const btnThis = document.getElementById(prefix+"_btnThisMonth");

  if(btnPrev) btnPrev.addEventListener("click", ()=>{
    calMonth0--; if(calMonth0<0){ calMonth0=11; calYear--; }
    renderAnalytics();
  });
  if(btnNext) btnNext.addEventListener("click", ()=>{
    calMonth0++; if(calMonth0>11){ calMonth0=0; calYear++; }
    renderAnalytics();
  });
  if(btnThis) btnThis.addEventListener("click", ()=>{
    const n=new Date(); calYear=n.getFullYear(); calMonth0=n.getMonth();
    renderAnalytics();
  });

  function renderAnalytics(){
    const w = weekStats();
    const wAvg = document.getElementById(prefix+"_weekAvg");
    const wDays = document.getElementById(prefix+"_weekDays");
    if(wAvg) wAvg.textContent = `${w.avg}%`;
    if(wDays) wDays.textContent = `ê¸°ë¡ ${w.count}ì¼`;

    const m = monthStats(calYear, calMonth0);
    const mAvg = document.getElementById(prefix+"_monthAvg");
    const mDays = document.getElementById(prefix+"_monthDays");
    if(mAvg) mAvg.textContent = `${m.avg}%`;
    if(mDays) mDays.textContent = `ê¸°ë¡ ${m.cntDaysWithData}ì¼`;

    renderWeekBars();
    renderCalendar();
  }

  renderAnalytics();
  updateProgress();
}

/* âœ… v5 â†’ v6ë¡œ ë°ì´í„° ë³µì‚¬ (v6ê°€ ë¹„ì–´ìˆì„ ë•Œë§Œ 1íšŒ) */
function migrateKey(oldKey, newKey){
  if (!localStorage.getItem(newKey) && localStorage.getItem(oldKey)) {
    localStorage.setItem(newKey, localStorage.getItem(oldKey));
  }
}
migrateKey("focus_dashboard_routine_v5", "focus_dashboard_routine_v6");
migrateKey("focus_dashboard_beauty_v5", "focus_dashboard_beauty_v6");

/* ===== ë‘ ëŒ€ì‹œë³´ë“œ ìƒì„± (ì €ì¥ì†Œ ë¶„ë¦¬) ===== */
createDashboard("r", "focus_dashboard_routine_v6");
createDashboard("b", "focus_dashboard_beauty_v6");
</script>