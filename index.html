<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ë‚˜ì˜ ì„ íƒê³¼ ì§‘ì¤‘ ëŒ€ì‹œë³´ë“œ</title>
<style>
:root{
  --bg:#0b1020; --card:#121a33; --text:#e9eeff; --muted:#8ea0c9;
  --line:rgba(255,255,255,.10); --accent:#7c5cff; --ok:#3ddc97; --danger:#ff6b6b;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,-apple-system,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;
  background:linear-gradient(180deg,#0b1020,#0e1430);color:var(--text)
}
.wrap{max-width:920px;margin:0 auto;padding:18px}
h1{margin:0 0 6px}
.sub{color:var(--muted);font-size:14px;margin:0 0 16px;line-height:1.45}

.card{
  background:var(--card);border:1px solid var(--line);
  border-radius:16px;padding:14px;margin-bottom:14px
}
.topbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
.btnrow{display:flex;gap:10px;flex-wrap:wrap}
button{
  border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--text);
  padding:9px 12px;border-radius:12px;font-size:13px;cursor:pointer
}
button:hover{border-color:rgba(124,92,255,.35)}
.danger:hover{border-color:rgba(255,107,107,.55)}

.section-title{font-size:15px;margin:0 0 10px}
.small{font-size:12px;color:var(--muted);font-weight:600}

.item{
  display:flex;gap:10px;align-items:flex-start;
  padding:10px;border-radius:12px;border:1px solid var(--line);
  margin-bottom:8px;background:rgba(0,0,0,.15)
}
input[type=checkbox]{width:18px;height:18px;margin-top:2px;accent-color:var(--accent)}
.desc{font-size:12px;color:var(--muted);margin-top:4px;line-height:1.4}

textarea{
  width:100%;min-height:120px;background:rgba(0,0,0,.2);
  border:1px solid var(--line);border-radius:12px;padding:10px;
  color:var(--text);font-size:13px;resize:vertical;line-height:1.5;outline:none
}

.progress{height:10px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden;margin-top:12px}
.bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--ok))}

.kpi{display:flex;gap:10px;margin-top:10px}
.kpi .box{
  flex:1;background:rgba(0,0,0,.2);border:1px solid var(--line);
  border-radius:12px;padding:10px
}
.num{font-size:22px;font-weight:800;margin-top:6px}

.listCard{
  border:1px solid var(--line);border-radius:12px;padding:10px;margin-top:10px;
  background:rgba(0,0,0,.12)
}
pre{white-space:pre-wrap;margin:8px 0 0;color:var(--text);font-family:inherit;font-size:13px;line-height:1.5}
hr{border:0;border-top:1px solid var(--line);margin:12px 0}
footer{color:var(--muted);font-size:12px;margin-top:10px;line-height:1.5}
<style>
  /* ê¸°ì¡´ CSSë“¤ */

  /* â¬‡ï¸ ì—¬ê¸°ë¶€í„° ì¶”ê°€ */
  /* ì£¼/ì›” í†µê³„, ê·¸ë˜í”„, ë‹¬ë ¥ ê´€ë ¨ CSS */
  .week-bars { â€¦ }
  .calendar { â€¦ }
  /* â¬†ï¸ ì—¬ê¸°ê¹Œì§€ */

</style>
</style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="topbar">
      <div>
        <h1>ë‚˜ì˜ ì„ íƒê³¼ ì§‘ì¤‘ ëŒ€ì‹œë³´ë“œ</h1>
        <div class="sub">ì²´í¬/ì¼ê¸°ëŠ” ìë™ ì €ì¥(ë‚ ì§œë³„) Â· ì§„í–‰ë¥  ì¦‰ì‹œ ë°˜ì˜</div>
        <div class="small">ì˜¤ëŠ˜ ë‚ ì§œ: <span id="dateLabel"></span></div>
      </div>
      <div class="btnrow">
        <button id="btnTodayReset">ì˜¤ëŠ˜ë§Œ ë¦¬ì…‹</button>
        <button class="danger" id="btnClearAll">ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
    </div>
  </div>

  <!-- ğŸŒ… ì•„ì¹¨ -->
  <div class="card" id="am">
    <div class="section-title">ğŸŒ… ì•„ì¹¨ ë£¨í‹´</div>

    <div class="item"><input type="checkbox" data-key="med"><div><b>ë§ˆìŒì±™ê¹€ ëª…ìƒ</b><div class="desc">5~10ë¶„, ê·¸ëƒ¥ ì•‰ê¸°</div></div></div>
    <div class="item"><input type="checkbox" data-key="run"><div><b>ëŸ¬ë‹/ë¹ ë¥¸ ê±·ê¸°</b><div class="desc">20~40ë¶„</div></div></div>
    <div class="item"><input type="checkbox" data-key="strength"><div><b>ê·¼ë ¥ìš´ë™ 20ë¶„</b></div></div>
    <div class="item"><input type="checkbox" data-key="dogwalk"><div><b>ê°•ì•„ì§€ ì‚°ì±…</b></div></div>
  </div>

  <!-- ğŸŒ™ ì €ë… -->
  <div class="card" id="pm">
    <div class="section-title">ğŸŒ™ ì €ë… ë£¨í‹´</div>

    <div class="item"><input type="checkbox" data-key="diet"><div><b>ì‹ë‹¨ ì¡°ì ˆ</b><div class="desc">ì ìƒ‰ìœ¡/ì†Œê¸ˆë¬¼/ë²„í„° ì„­ì·¨ ì˜ì‹</div></div></div>
    <div class="item"><input type="checkbox" data-key="omad"><div><b>1ì¼ 1ì‹</b></div></div>
    <div class="item"><input type="checkbox" data-key="save"><div><b>ì ˆì•½: ëˆ ì•ˆ ì“°ê¸°</b></div></div>
    <div class="item"><input type="checkbox" data-key="simplify"><div><b>ìƒí™œ ë‹¨ìˆœí™”: ë¶ˆí•„ìš” 1ê°œ ì‚­ì œ</b></div></div>
    <div class="item"><input type="checkbox" data-key="gear"><div><b>ëŸ°ë‹ì¡°ë¼/ë…¸íŠ¸ë¶ ì¤€ë¹„</b></div></div>
    <div class="item"><input type="checkbox" data-key="computer"><div><b>ì»´ ê°€ê¹Œì´ ë£¨í‹´ 1íšŒ</b><div class="desc">25ë¶„ ì§‘ì¤‘ + ê¸°ë¡</div></div></div>
    <div class="item"><input type="checkbox" data-key="lifeplan"><div><b>ì¸ìƒ ê³„íš 10ë¶„</b></div></div>
    <div class="item"><input type="checkbox" data-key="esteem"><div><b>ìì¡´ê° ì±„ìš°ê¸°</b><div class="desc">ì˜¤ëŠ˜ ì˜í•œ ê²ƒ 1ê°œ ì ê¸°</div></div></div>

    <div class="item"><input type="checkbox" data-key="eng"><div><b>ì˜ì–´ ì–´í”Œ 15ë¶„</b></div></div>
    <div class="item"><input type="checkbox" data-key="worksheet"><div><b>í•™ìŠµì§€ 1íšŒ</b></div></div>
    <div class="item"><input type="checkbox" data-key="friend"><div><b>ì™¸êµ­ì¸ ì¹œêµ¬ í–‰ë™ 1ê°œ</b></div></div>

    <div class="item"><input type="checkbox" data-key="dogcare"><div><b>ê°•ì•„ì§€ ì¼€ì–´</b><div class="desc">ì–‘ì¹˜(ë§¤ì¼) / ëª©ìš•Â·ìœ„ìƒ(í•„ìš”ì‹œ)</div></div></div>
  </div>

  <!-- ğŸ“– ì¼ê¸° -->
  <div class="card">
    <div class="section-title">ğŸ“– ì˜¤ëŠ˜ ì¼ê¸° (ë‚ ì§œë³„ ì €ì¥)</div>
    <textarea id="journal" placeholder="1) ì˜¤ëŠ˜ í•œ ì¼&#10;2) ëŠë‚€ ì &#10;3) ë‚´ì¼ì˜ í•œ ê°€ì§€"></textarea>

    <div class="btnrow" style="margin-top:10px;justify-content:flex-end">
      <button id="btnDiaryList">ğŸ“š ì¼ê¸° ê¸°ë¡ ë³´ê¸°</button>
      <button id="btnDiaryExport">â¬‡ï¸ ì¼ê¸° ë°±ì—…(JSON)</button>
    </div>

    <div id="diaryList" style="display:none;"></div>
  </div>

  <!-- ğŸ“Š ì§„í–‰ë¥  -->
  <div class="card">
    <div class="progress"><div class="bar" id="bar"></div></div>
    <div class="kpi">
      <div class="box">ì˜¤ëŠ˜ ì§„í–‰ë¥ <div class="num" id="percent">0%</div></div>
      <div class="box">ì™„ë£Œ í•­ëª©<div class="num"><span id="done">0</span>/<span id="total">0</span></div></div>
    </div>
  </div>

  <footer>
    âœ” ì´ í˜ì´ì§€ì˜ ì²´í¬/ì¼ê¸° ë°ì´í„°ëŠ” <b>ì´ ë¸Œë¼ìš°ì €(LocalStorage)</b>ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.<br/>
    âœ” í°ì„ ë°”ê¾¸ê±°ë‚˜ ë¸Œë¼ìš°ì € ë°ì´í„°ë¥¼ ì§€ìš°ë©´ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš” â†’ â€œì¼ê¸° ë°±ì—…(JSON)â€ ê¶Œì¥.
  </footer>
</div>
<!-- ====== ì£¼/ì›” í†µê³„ + ê·¸ë˜í”„ + ë‹¬ë ¥ (í‘œì‹œ ìë¦¬) ====== -->
<div class="card" id="analyticsCard">
  <h2 style="margin:0 0 10px;">ì£¼/ì›” ì§„í–‰ë¥ </h2>

  <div class="grid2">
    <div class="statbox">
      <div class="statlabel">ì´ë²ˆ ì£¼ í‰ê· </div>
      <div class="statnum" id="weekAvg">0%</div>
      <div class="statdesc" id="weekDays">ê¸°ë¡ 0ì¼</div>
    </div>

    <div class="statbox">
      <div class="statlabel">ì´ë²ˆ ë‹¬ í‰ê· </div>
      <div class="statnum" id="monthAvg">0%</div>
      <div class="statdesc" id="monthDays">ê¸°ë¡ 0ì¼</div>
    </div>
  </div>

  <div style="height:12px"></div>

  <div class="statlabel">ìµœê·¼ 7ì¼ ê·¸ë˜í”„</div>
  <div id="weekBars" class="weekbars"></div>

  <div style="height:14px"></div>

  <div class="row" style="justify-content:space-between">
    <div class="statlabel">ì›”ê°„ ë‹¬ë ¥</div>
    <button id="btnThisMonth" type="button">ì´ë²ˆ ë‹¬</button>
  </div>
  <div id="calendar" class="calendar"></div>
</div>

<!-- ====== ë‚ ì§œ í´ë¦­ ì‹œ íŒì—…(ëª¨ë‹¬): í•´ë‹¹ ë‚ ì§œ ì²´í¬/ì¼ê¸° ë³´ê¸° ====== -->
<div id="dayModalBackdrop" class="modalbackdrop" style="display:none">
  <div class="modal">
    <div class="row" style="justify-content:space-between; align-items:center">
      <div>
        <div class="statlabel">ê¸°ë¡ ë³´ê¸°</div>
        <div class="statnum" id="dayModalTitle" style="font-size:18px">YYYY-MM-DD</div>
      </div>
      <button id="btnCloseDayModal" type="button">ë‹«ê¸°</button>
    </div>

    <div style="height:10px"></div>
    <div class="grid2">
      <div class="statbox">
        <div class="statlabel">ì§„í–‰ë¥ </div>
        <div class="statnum" id="dayModalPct">0%</div>
      </div>
      <div class="statbox">
        <div class="statlabel">ì™„ë£Œ</div>
        <div class="statnum"><span id="dayModalDone">0</span>/<span id="dayModalTotal">0</span></div>
      </div>
    </div>

    <div style="height:12px"></div>
    <div class="statlabel">ğŸ“– ê·¸ë‚ ì˜ ì¼ê¸°</div>
    <div id="dayModalJournal" class="journalview">ê¸°ë¡ ì—†ìŒ</div>
  </div>
</div>
<script>
const $$ = s => Array.from(document.querySelectorAll(s));
const $ = s => document.querySelector(s);
const STORAGE_KEY = "focus_dashboard_v2";

const todayKey = () => new Date().toISOString().slice(0,10);

function load(){
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}"); }
  catch(e){ return {}; }
}
function save(v){ localStorage.setItem(STORAGE_KEY, JSON.stringify(v)); }

const state = load();
if(!state.daily) state.daily = {};
if(!state.journals) state.journals = {};
const T = todayKey();
if(!state.daily[T]) state.daily[T] = {};

$("#dateLabel").textContent = T;

function boxes(){
  return $$("input[type=checkbox][data-key]");
}

function update(){
  const b = boxes();
  const total = b.length;
  const done = b.filter(x => x.checked).length;
  const pct = total ? Math.round(done/total*100) : 0;
  $("#done").textContent = done;
  $("#total").textContent = total;
  $("#percent").textContent = pct + "%";
  $("#bar").style.width = pct + "%";
}

boxes().forEach(b=>{
  const k = b.dataset.key;
  b.checked = !!state.daily[T][k];
  b.addEventListener("change", ()=>{
    state.daily[T][k] = b.checked;
    save(state);
    update();
  });
});

// ì¼ê¸°: ë‚ ì§œë³„
const journal = $("#journal");
journal.value = state.journals[T] || "";
journal.addEventListener("input", ()=>{
  state.journals[T] = journal.value;
  save(state);
});

// ì¼ê¸° ëª©ë¡
function esc(s){ return (s||"").replace(/</g,"&lt;"); }

function renderDiaryList(){
  const box = $("#diaryList");
  const entries = Object.entries(state.journals || {})
    .filter(([d, txt]) => (txt||"").trim().length > 0)
    .sort((a,b)=> b[0].localeCompare(a[0]));

  if(entries.length === 0){
    box.innerHTML = `<div class="small">ì•„ì§ ì €ì¥ëœ ì¼ê¸°ê°€ ì—†ì–´ìš”.</div>`;
    return;
  }

  box.innerHTML = entries.map(([d, txt]) => `
    <div class="listCard">
      <div class="topbar" style="padding:0;margin:0;border:0">
        <b>${d}</b>
        <button class="danger" type="button" data-del="${d}">ì‚­ì œ</button>
      </div>
      <pre>${esc(txt)}</pre>
    </div>
  `).join("");

  box.querySelectorAll("button[data-del]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const d = btn.getAttribute("data-del");
      if(!confirm(`${d} ì¼ê¸°ë¥¼ ì‚­ì œí• ê¹Œìš”?`)) return;
      delete state.journals[d];
      save(state);
      renderDiaryList();
    });
  });
}

$("#btnDiaryList").addEventListener("click", ()=>{
  const box = $("#diaryList");
  const open = box.style.display !== "none";
  box.style.display = open ? "none" : "block";
  if(!open) renderDiaryList();
});

$("#btnDiaryExport").addEventListener("click", ()=>{
  const data = { journals: state.journals || {} };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "diary-backup.json";
  a.click();
  URL.revokeObjectURL(a.href);
});

$("#btnTodayReset").addEventListener("click", ()=>{
  if(!confirm("ì˜¤ëŠ˜ ì²´í¬ì™€ ì˜¤ëŠ˜ ì¼ê¸°ë§Œ ë¦¬ì…‹í• ê¹Œìš”?")) return;
  state.daily[T] = {};
  state.journals[T] = "";
  save(state);
  boxes().forEach(b=> b.checked = false);
  journal.value = "";
  update();
});

$("#btnClearAll").addEventListener("click", ()=>{
  if(!confirm("ì „ì²´ ë°ì´í„°(ì²´í¬/ì¼ê¸°)ë¥¼ ëª¨ë‘ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
});

update();
// ===== ì£¼/ì›” ì§‘ê³„ + ê·¸ë˜í”„ + ë‹¬ë ¥ =====
function pad2(n){ return String(n).padStart(2,"0"); }
function ymd(d){
  return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
}
function parseYMD(s){
  const [y,m,d]=s.split("-").map(Number);
  return new Date(y, m-1, d);
}
function sameDay(a,b){
  return a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate();
}
function esc(s){ return (s||"").replace(/</g,"&lt;"); }

// í˜„ì¬ ì²´í¬ë°•ìŠ¤ key ëª©ë¡(ì´ í•­ëª© ìˆ˜ì˜ ê¸°ì¤€)
function keysList(){
  return boxes().map(b => b.dataset.key);
}

function progressOf(dateStr){
  const keys = keysList();
  const daily = (state.daily && state.daily[dateStr]) ? state.daily[dateStr] : {};
  const total = keys.length;
  const done = keys.filter(k => !!daily[k]).length;
  const pct = total ? Math.round(done/total*100) : 0;
  return { total, done, pct };
}

function startOfWeekMonday(d){
  // ì›”ìš”ì¼ ì‹œì‘(í•œêµ­ ê¸°ì¤€)
  const day = d.getDay(); // 0 ì¼ ~ 6 í† 
  const diff = (day === 0) ? -6 : (1 - day);
  const s = new Date(d);
  s.setDate(s.getDate() + diff);
  s.setHours(0,0,0,0);
  return s;
}

function weekStats(){
  const today = new Date();
  const start = startOfWeekMonday(today);
  const days = [];
  let sum = 0, count = 0;

  for(let i=0;i<7;i++){
    const d = new Date(start);
    d.setDate(start.getDate()+i);
    const ds = ymd(d);
    const {pct} = progressOf(ds);
    days.push({ds, pct});
    if ((state.daily && state.daily[ds]) && Object.keys(state.daily[ds]).length>0) count++;
    sum += pct;
  }
  return {
    avg: Math.round(sum/7),
    count,
    days
  };
}

function monthStats(year, month0){
  const first = new Date(year, month0, 1);
  const last = new Date(year, month0+1, 0);
  let sum = 0;
  let cntDaysWithData = 0;

  for(let day=1; day<=last.getDate(); day++){
    const d = new Date(year, month0, day);
    const ds = ymd(d);
    const {pct} = progressOf(ds);
    sum += pct;
    if ((state.daily && state.daily[ds]) && Object.keys(state.daily[ds]).length>0) cntDaysWithData++;
  }
  const avg = Math.round(sum / last.getDate());
  return { avg, cntDaysWithData, first, last };
}

function renderWeekBars(){
  const el = $("#weekBars");
  if(!el) return;

  // ìµœê·¼ 7ì¼(ì˜¤ëŠ˜ í¬í•¨)
  const today = new Date();
  const bars = [];
  for(let i=6;i>=0;i--){
    const d = new Date(today);
    d.setDate(today.getDate()-i);
    const ds = ymd(d);
    const {pct} = progressOf(ds);

    const h = Math.max(6, Math.round(pct*0.9)); // 0%ë„ ì¡°ê¸ˆì€ ë³´ì´ê²Œ
    const isToday = (ds === todayKey());

    bars.push(`
      <div style="display:flex;flex-direction:column;gap:6px;align-items:stretch">
        <div title="${ds} (${pct}%)"
          style="height:${h}px;border-radius:10px;border:1px solid var(--line);
                 background:rgba(124,92,255,.20); box-shadow:${isToday ? "0 0 0 2px rgba(124,92,255,.18) inset" : "none"}">
        </div>
        <div class="small" style="text-align:center">${ds.slice(8,10)}</div>
      </div>
    `);
  }
  el.innerHTML = bars.join("");
}

let calYear = new Date().getFullYear();
let calMonth0 = new Date().getMonth();

function renderCalendar(){
  const grid = $("#calGrid");
  const label = $("#calLabel");
  if(!grid || !label) return;

  const first = new Date(calYear, calMonth0, 1);
  const last = new Date(calYear, calMonth0+1, 0);
  const startDow = first.getDay(); // 0 Sun
  const today = new Date();

  label.textContent = `ì›”ê°„ ë‹¬ë ¥ Â· ${calYear}-${pad2(calMonth0+1)}`;

  const dows = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
  const cells = [];

  // ìš”ì¼ í—¤ë”
  for(const d of dows){
    cells.push(`
      <div class="small" style="text-align:center;padding:6px 0;color:var(--muted)">${d}</div>
    `);
  }

  // ë¹ˆì¹¸
  for(let i=0;i<startDow;i++){
    cells.push(`<div style="height:44px;opacity:.25;border:1px solid rgba(255,255,255,.06);border-radius:10px"></div>`);
  }

  for(let day=1; day<=last.getDate(); day++){
    const d = new Date(calYear, calMonth0, day);
    const ds = ymd(d);
    const {pct} = progressOf(ds);

    // í¼ì„¼íŠ¸ì— ë”°ë¼ ì§„í•˜ê¸°(ë‹¨ìˆœ)
    const alpha = 0.08 + (pct/100)*0.35; // 0.08~0.43
    const isToday = sameDay(d, today);

    cells.push(`
      <button type="button" data-date="${ds}"
        style="height:44px;border-radius:10px;border:1px solid rgba(255,255,255,.10);
               background:rgba(124,92,255,${alpha}); color:var(--text); text-align:left;
               padding:8px; cursor:pointer; ${isToday ? "box-shadow:0 0 0 2px rgba(124,92,255,.20) inset;border-color:rgba(124,92,255,.55);" : ""}">
        <div style="display:flex;justify-content:space-between;gap:8px;align-items:center">
          <b style="font-size:12px">${day}</b>
          <span style="font-size:11px;color:rgba(255,255,255,.75)">${pct}%</span>
        </div>
      </button>
    `);
  }

  grid.innerHTML = cells.join("");

  // í´ë¦­ â†’ ë‚ ì§œ ìƒì„¸ íŒì—…
  grid.querySelectorAll("button[data-date]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const ds = btn.getAttribute("data-date");
      openDayModal(ds);
    });
  });
}

function openDayModal(dateStr){
  const back = $("#dayModalBackdrop");
  const title = $("#dayModalTitle");
  const meta = $("#dayModalMeta");
  const diary = $("#dayModalDiary");
  if(!back || !title || !meta || !diary) return;

  const {done,total,pct} = progressOf(dateStr);
  title.textContent = `ğŸ“… ${dateStr}`;
  meta.textContent = `ì§„í–‰ë¥  ${pct}% Â· ì™„ë£Œ ${done}/${total}`;
  diary.textContent = (state.journals && state.journals[dateStr]) ? state.journals[dateStr] : "(ì¼ê¸° ì—†ìŒ)";
  back.style.display = "flex";
}

function closeDayModal(){
  const back = $("#dayModalBackdrop");
  if(back) back.style.display = "none";
}

// ë‹¬ë ¥ ë„¤ë¹„ ë²„íŠ¼
const btnPrevMonth = $("#btnPrevMonth");
const btnNextMonth = $("#btnNextMonth");
const btnThisMonth = $("#btnThisMonth");
if(btnPrevMonth) btnPrevMonth.addEventListener("click", ()=>{
  calMonth0--; if(calMonth0<0){ calMonth0=11; calYear--; }
  renderAnalytics();
});
if(btnNextMonth) btnNextMonth.addEventListener("click", ()=>{
  calMonth0++; if(calMonth0>11){ calMonth0=0; calYear++; }
  renderAnalytics();
});
if(btnThisMonth) btnThisMonth.addEventListener("click", ()=>{
  const n=new Date(); calYear=n.getFullYear(); calMonth0=n.getMonth();
  renderAnalytics();
});

// ëª¨ë‹¬ ë‹«ê¸°
const btnCloseDayModal = $("#btnCloseDayModal");
const dayModalBackdrop = $("#dayModalBackdrop");
if(btnCloseDayModal) btnCloseDayModal.addEventListener("click", closeDayModal);
if(dayModalBackdrop) dayModalBackdrop.addEventListener("click", (e)=>{
  if(e.target && e.target.id==="dayModalBackdrop") closeDayModal();
});

function renderAnalytics(){
  // ì£¼ ìš”ì•½
  const w = weekStats();
  const weekAvg = $("#weekAvg");
  const weekDays = $("#weekDays");
  if(weekAvg) weekAvg.textContent = `${w.avg}%`;
  if(weekDays) weekDays.textContent = `${w.count}`;

  // ì›” ìš”ì•½
  const m = monthStats(calYear, calMonth0);
  const monthAvg = $("#monthAvg");
  const monthDays = $("#monthDays");
  if(monthAvg) monthAvg.textContent = `${m.avg}%`;
  if(monthDays) monthDays.textContent = `${m.cntDaysWithData}`;

  renderWeekBars();
  renderCalendar();
}
// ===== ë =====
</script>
</body>
</html>